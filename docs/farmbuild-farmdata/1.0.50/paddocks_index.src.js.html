<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>paddocks/index.src.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-farmdata.html">farmdata</a><ul class='methods'><li data-type='method'><a href="module-farmdata.html#.create">create</a></li><li data-type='method'><a href="module-farmdata.html#.find">find</a></li><li data-type='method'><a href="module-farmdata.html#.isFarmData">isFarmData</a></li><li data-type='method'><a href="module-farmdata.html#.load">load</a></li><li data-type='method'><a href="module-farmdata.html#.merge">merge</a></li><li data-type='method'><a href="module-farmdata.html#.save">save</a></li><li data-type='method'><a href="module-farmdata.html#.update">update</a></li><li data-type='method'><a href="module-farmdata.html#.validate">validate</a></li></ul></li><li><a href="module-farmdataPaddocks.html">farmdataPaddocks</a></li></ul><h3>Global</h3><ul><li><a href="global.html#export">export</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">paddocks/index.src.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @since 0.0.1
 * @copyright 2015 Spatial Vision, Inc. http://spatialvision.com.au
 * @license The MIT License
 * @author Spatial Vision
 * @version 1.0.0
 */

'use strict';

/**
 * farmdataPaddocks class
 * @module farmdataPaddocks
 */
angular.module('farmbuild.farmdata')
	.factory('farmdataPaddocks',
	function ($log,
	          collections,
	          validations,
	          farmdataConverter) {
		var farmdataPaddocks =
			{},
			isEmpty = validations.isEmpty,
			isDefined = validations.isDefined
			;

		function createName() {
			return 'Paddock ' + (new Date()).getTime();
		}

		function generateId() {
			return (new Date()).getTime();
		}

		function createPaddockFeature(geoJsonGeometry) {
			return farmdataConverter.createFeature(geoJsonGeometry, createName());
		}

		farmdataPaddocks.createPaddockFeature = createPaddockFeature;

		function createPaddock(paddockFeature) {
			var name = paddockFeature.properties.name,
				id = paddockFeature.properties._id;
			name = isDefined(name) ? name : createName();
			id = isDefined(id) ? id : generateId();
			return {
				name: name,
				_id: id,
				geometry: farmdataConverter.convertToFarmDataGeometry(paddockFeature.geometry),
				dateLastUpdated: new Date()
			};
		}

		farmdataPaddocks.createPaddock = createPaddock;

		function findPaddock(paddock, paddocks) {
			var found;
			if (!paddock.properties._id) {
				return;
			}
			paddocks.forEach(function (p) {
				if (paddock.properties._id === p._id) {
					found = p;
				}
			});
			return found;
		}

		farmdataPaddocks.findPaddock = findPaddock;

		function updatePaddock(paddockFeature, paddocksExisting) {
			var toUpdate = angular.copy(findPaddock(paddockFeature, paddocksExisting));
			toUpdate.name = paddockFeature.properties.name;
			toUpdate.commment = paddockFeature.properties.commment;
			toUpdate.type = paddockFeature.properties.type;
			toUpdate.geometry = paddockFeature.geometry;
			toUpdate.area = paddockFeature.area;
			toUpdate.dateLastUpdated = new Date();
			return toUpdate;
		}

		farmdataPaddocks.updatePaddock = updatePaddock;

		function isNew(paddockFeature) {
			return !isDefined(paddockFeature.properties._id);
		}

		function merge(paddockFeature, paddocksExisting) {
//      farmData.paddocks[i].geometry = paddockFeature.geometry;
//      delete farmData.paddocks[i].geometry.crs;

			if (isNew(paddockFeature)) {
				return createPaddock(paddockFeature);
			}

			return updatePaddock(paddockFeature, paddocksExisting)
		}

		farmdataPaddocks.merge = function (farmData, geoJsons) {
			var paddockFeatures = geoJsons.paddocks,
				paddocksExisting = farmData.paddocks,
				paddocksMerged = [];

			paddockFeatures.features.forEach(function (paddockFeature, i) {
				paddocksMerged.push(merge(paddockFeature, paddocksExisting));
			});

			farmData.paddocks = paddocksMerged;

			return farmData;

		}


//    function _add(geoJsons, geoJsonGeometry) {
//      $log.info('farmdataPaddocks.add item ...', geoJsonGeometry);
//      geoJsons.paddocks.features.push(geoJsonGeometry);
//      return geoJsons;
//    };
//
//    farmdataPaddocks.add = _add

		return farmdataPaddocks;

	});
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-beta3</a> on Thu Jun 11 2015 08:52:26 GMT+1000 (AEST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
